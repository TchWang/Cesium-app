<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cesium-app</title>
    <script src="./scripts/Cesium/Cesium.js"></script>
    <link rel="stylesheet" href="./scripts/Cesium/Widgets/widgets.css">
    <style>
        html, body {
            height: 100%;
            margin: 0px;
            padding: 0px;
        }
    </style>
</head>
<body>
    <div id="cesiumcontainer" style="height: 100%;"></div>
    <script>
        
        var longitude, latitude, altitude;

        function Location() {};
        
        Location.prototype.m_getLocation = function (callback) {
            var options = {
                enableHighAccuracy: true,
                maximumAge: 1000
            };
            this.callback = Object.prototype.toString.call(callback) == "[object Function]" ?
                callback : function (address) {
                    alert(address.province + address.city);
                    console.log("getocation(callbackFunction) 可获得定位信息对象");
                };
            
            var self = this;
            this.gotlocation = 0;
            if (navigator.geolocation) {
                //浏览器支持geolocation
                navigator.geolocation.getCurrentPosition(function (position) {
                    //经度
                    var longitude = position.coords.longitude;
                    //纬度
                    var latitude = position.coords.latitude;
                    //海拔
                    var altitude = position.coords.altitude;

                    this.callback([longitude,latitude,altitude]);
                    //self.loadMapApi(longitude, latitude);
                    
                    this.gotlocation = 1;
                }, this.onError, options);
            } else {
                //浏览器不支持geolocation
            }
        };

        // Location.prototype.loadMapApi = function (longitude, latitude) {
        //     var self = this;
        //     var oHead = document.getElementsByTagName('HEAD').item(0);
        //     var oScript = document.createElement("script");
        //     oScript.type = "text/javascript";
        //     oScript.src = "http://api.map.baidu.com/getscript?v=2.0&ak=A396783ee700cfdb9ba1df281ce36862&services=&t=20140930184510";
        //     oHead.appendChild(oScript);
        //     oScript.onload = function (date) {
        //         var point = new BMap.Point(longitude, latitude);
        //         var gc = new BMap.Geocoder();
        //         gc.getLocation(point, function (rs) {
        //             var addComp = rs.addressComponents;
        //             self.callback(addComp);
        //         });
        //     }
        // };

        Location.prototype.onError = function (error) {
            switch (error.code) {
            case 1:
                alert("位置服务被拒绝");
                break;Z
            case 2:
                alert("暂时获取不到位置信息");
                break;
            case 3:
                alert("获取信息超时");
                break;
            case 4:
                alert("未知错误");
                break;
            }
        };

        //调用
        var local = new Location();
        local.m_getLocation(function (res) {
            //此处就是返回的地理位置信息
            
            window.longitude = res[0];
            window.latitude = res[1];
            window.altitude = res[2];
            //把返回的对象转为字符串了，自己根据需求截取下就好
            //var resstr = JSON.stringify(res);
            //alert(resstr);
        });

        alert([longitude,latitude,altitude]);

        Cesium.Ion.defaultAccessToken = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJqdGkiOiI2YzIzZjFkYi01YzU2LTQ1YmEtYWIzOC00MzVhNjAzY2E2MDEiLCJpZCI6ODMyMDEsImlhdCI6MTY0NTQzMDEzMX0.g62phdhvaMrDUyvw-qVayetbr39pVAqS5Ka1ipdSR04'

        var image = new Cesium.ArcGisMapServerImageryProvider({
            url: 'https://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer'
        });
        var terrain = new Cesium.createWorldTerrain({           
            requestWaterMask:true,           
            requestVertexNormals:true       
        }); 

        var viewer = new Cesium.Viewer('cesiumcontainer', {
            //需要进行可视化的数据源的集合
            animation: false, //是否显示动画控件
            shouldAnimate : true,
            homeButton: false, //是否显示Home按钮
            fullscreenButton: false, //是否显示全屏按钮
            baseLayerPicker: false, //是否显示图层选择控件
            geocoder: false, //是否显示地名查找控件
            timeline: false, //是否显示时间线控件
            sceneModePicker: true, //是否显示投影方式控件
            navigationHelpButton: false, //是否显示帮助信息控件
            infoBox: false, //是否显示点击要素之后显示的信息
            requestRenderMode: true, //启用请求渲染模式
            scene3DOnly: false, //每个几何实例将只能以3D渲染以节省GPU内存
            sceneMode: 3, //初始场景模式 1 2D模式 2 2D循环模式 3 3D模式  Cesium.SceneMode
            fullscreenElement: document.body, //全屏时渲染的HTML元素 暂时没发现用处
            //天地图是官方开元的地图，不需要密钥

            imageryProvider: image,
            terrainProvider: terrain
        });

        // viewer.camera.flyTo({
        //     destination: Cesium.Cartesian3.fromDegrees(103.84, 31.15, 17850000),
        //     orientation: {
        //         heading : Cesium.Math.toRadians(348.4202942851978),
        //         pitch : Cesium.Math.toRadians(-89.74026687972041),
        //         roll : Cesium.Math.toRadians(0)
        //     },
        //     complete:function callback() {
                
        //         // 定位完成之后的回调函数
        //     }
        // });
        if (local.gotlocation) {
            viewer.camera.flyTo({
                destination: Cesium.Cartesian3.fromDegrees(longitude,latitude,altitude),
                orientation: {
                    heading : 0.22348625575525194,
                    pitch : -0.4301601970612787,
                    roll : Cesium.Math.toRadians(0)
                }
            });
        }
        
    </script>
</body>
</html>
